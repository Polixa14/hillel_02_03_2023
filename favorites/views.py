from django.contrib.auth.decorators import login_requiredfrom django.utils.decorators import method_decoratorfrom django.views.generic import ListView, RedirectViewfrom products.models import Productfrom favorites.models import FavoriteProductfrom django.db import IntegrityErrorfrom django.urls import reverseclass FavoriteView(ListView):    model = FavoriteProduct    template_name = 'favorite/index.html'    context_object_name = 'favorite_products'    @method_decorator(login_required)    def dispatch(self, request, *args, **kwargs):        return super().dispatch(request, *args, **kwargs)    def get_queryset(self):        return FavoriteProduct.objects.filter(user=self.request.user)class AddToFavoriteProduct(RedirectView):    def get_redirect_url(self, slug, *args, **kwargs):        product = Product.objects.get(slug=slug)        try:            FavoriteProduct.objects.create(                product=product,                user=self.request.user            )        except IntegrityError:            FavoriteProduct.objects.get(                product=product,                user=self.request.user            ).delete()        return reverse('details', kwargs={'slug': slug})