from django.contrib.auth.decorators import login_requiredfrom django.http import JsonResponsefrom django.utils.decorators import method_decoratorfrom django.views.generic import ListView, DetailViewfrom favorites.models import FavoriteProductfrom project.decorators import ajax_requiredfrom products.models import Productclass FavoriteView(ListView):    model = FavoriteProduct    context_object_name = 'favorite_products'    @method_decorator(login_required)    def dispatch(self, request, *args, **kwargs):        return super().dispatch(request, *args, **kwargs)    def get_queryset(self):        return FavoriteProduct.objects.filter(            user=self.request.user        ).select_related('product')class AJAXAddToFavoriteProduct(DetailView):    model = Product    @method_decorator(login_required)    @method_decorator(ajax_required)    def dispatch(self, request, *args, **kwargs):        return super().dispatch(request, *args, **kwargs)    def get(self, request, *args, **kwargs):        self.object = self.get_object()        favorite_product, created = FavoriteProduct.objects.get_or_create(            user=request.user,            product=self.object        )        if not created:            favorite_product.delete()        return JsonResponse({'is_favorite': created})